Metadata-Version: 2.4
Name: financial-data-collector
Version: 0.1.0
Summary: Phase 1 data collector and bulk export service
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: fastapi>=0.128.8
Requires-Dist: psycopg[binary]>=3.1
Requires-Dist: pykrx-openapi>=0.1.0
Requires-Dist: requests>=2.32.5
Requires-Dist: uvicorn[standard]>=0.39.0
Provides-Extra: parquet
Requires-Dist: pyarrow>=14.0.0; extra == "parquet"
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: freezegun>=1.5.1; extra == "dev"

﻿# financial_data_collector

湲덉쑖 ?쒓퀎???곗씠???섏쭛/?뺢퇋??寃利?臾몄꽌 ??μ냼?낅땲??

## 媛쒕컻 ?섍꼍(uv)
1. uv ?ㅼ튂 ?뺤씤:
- `uv --version`
2. 媛?곹솚寃?+ ?섏〈???ㅼ튂:
- `uv sync --extra dev --extra parquet`
3. ?꾩껜 ?뚯뒪???ㅽ뻾:
- `uv run pytest -q`

## 臾몄꽌 援ъ“
- `docs/README.md`: 臾몄꽌 ?꾩껜 ?대퉬寃뚯씠??- `docs/ARCHITECTURE.md`: ?ㅺ퀎 ?먯튃怨?Phase 濡쒕뱶留?- `docs/API_COLLECTION_PLAN.md`: ?곗씠???뚯뒪-?ㅽ궎留?留ㅽ븨 怨꾪쉷
- `docs/KRX_API_COLLECTION_SPEC.md`: KRX ?섏쭛 API 紐낆꽭
- `docs/IMPLEMENTATION_GUIDE.md`: Phase蹂?援ы쁽 吏?쒖꽌
- `docs/PHASE1_INTERFACE_DESIGN.md`: Phase 1 + 議고쉶 ?명꽣?섏씠???ㅺ퀎??- `docs/BULK_EXPORT_API_SPEC.md`: 湲곌컙 踰뚰겕 異붿텧 API 洹쒓꺽
- `docs/SCHEMA.md`: ?ㅽ궎留?怨꾩빟 臾몄꽌
- `docs/SCOPE_REVIEW.md`: 踰붿쐞 諛??곹빀???먭? 湲곕줉
- `sql/platform_schema.sql`: ?ㅽ뻾 DDL(Phase 1~4)

## 沅뚯옣 ?쎄린 ?쒖꽌
1. `docs/ARCHITECTURE.md`
2. `docs/SCHEMA.md`
3. `docs/API_COLLECTION_PLAN.md`
4. `docs/IMPLEMENTATION_GUIDE.md`

## 援ы쁽 ?쒖옉??- DB ?앹꽦: `sql/platform_schema.sql`
- 援ы쁽 李⑹닔: `docs/IMPLEMENTATION_GUIDE.md`??Phase 1

## KRX ?ㅼ뿰???뚯뒪??以鍮?1. `.env.example`??李멸퀬??`.env` ?묒꽦
2. ?꾩닔 媛??낅젰:
- `KRX_AUTH_KEY`
- `KRX_BASE_URL`
- `KRX_API_PATH_INSTRUMENTS`
- `KRX_API_PATH_DAILY_MARKET`
- `KRX_API_PATH_INDEX_DAILY`
3. ?ъ쟾?먭? ?뚯뒪??
- `uv run pytest -q tests/test_preflight.py`
4. ?ㅼ뿰???ㅻえ???뚯뒪??
- `uv run pytest -q -m integration`

## PostgreSQL ?ㅽ궎留?怨꾩빟 ?뚯뒪??1. PostgreSQL ?곌껐 臾몄옄??以鍮??? `postgresql://user:pass@localhost:5432/postgres`)
2. ?섍꼍蹂???ㅼ젙:
- `TEST_POSTGRES_DSN=<?곌껐臾몄옄??`
3. ?ㅽ뻾:
- `uv run pytest -q -m postgres tests/test_schema_contract_postgres.py`

?꾩떆 而⑦뀒?대꼫濡???踰덉뿉 ?ㅽ뻾(Windows PowerShell):
- `.\scripts\run_postgres_tests.ps1`

pytest留뚯쑝濡??꾩떆 而⑦뀒?대꼫 ?먮룞 ?ㅽ뻾:
1. `.env` ?ㅼ젙
- `TEST_POSTGRES_USE_TEMP_CONTAINER=1`
- `TEST_POSTGRES_DOCKER_PORT=5431`
2. ?ㅽ뻾
- `uv run pytest -q -m postgres -rs`

## 1Y KOSDAQ ?대낫?닿린 ?깅뒫 ?뚯뒪???듭뀡)
1. ?ㅽ뻾 ?뚮옒洹??ㅼ젙:
- `RUN_PERF_TESTS=1`
2. ?덉슜 ?쒓컙(珥? ?ㅼ젙(?듭뀡):
- `PERF_MAX_EXPORT_SECONDS=10`
3. ?ㅽ뻾:
- `uv run pytest -q -m performance tests/test_export_performance.py`

## 諛깊뀒?ㅽ듃 ?섑뵆 ?곗씠?곗뀑 ?앹꽦
肄붾뱶 吏꾩엯??
- `src/financial_data_collector/sample_backtest_run.py`

## uv lock ?뚯씪 ?앹꽦
?꾩옱 ?몄뀡(?뚮뱶諛뺤뒪)?먯꽌??Python ?ㅽ뻾 ?뚯씪 ?묎렐 ?쒗븳?쇰줈 `uv lock` ?앹꽦???ㅽ뙣?????덉뒿?덈떎.
濡쒖뺄 ?쇰컲 ?곕??먯뿉?쒕뒗 ?꾨옒 紐낅졊?쇰줈 lock ?뚯씪???앹꽦?????덉뒿?덈떎.
- `uv lock`

## KRX ?곗씠???섏쭛 ?ㅽ겕由쏀듃
- ?ㅽ뻾(湲곕낯: KOSDAQ + KOSPI ?숈떆 ?섏쭛): `uv run collect-krx-data --date-from 2026-01-02 --date-to 2026-01-10`
- 紐⑤뱢 ?ㅽ뻾(湲곕낯: KOSDAQ + KOSPI ?숈떆 ?섏쭛): `uv run python -m financial_data_collector.collect_krx_data --date-from 2026-01-02 --date-to 2026-01-10`
- ?듭뀡:
- `--database-url postgresql://user:pass@localhost:5432/postgres`
- ?⑥씪 ?쒖옣留??섏쭛: `--market-code KOSDAQ` (?꾩슂 ??`--index-code KOSDAQ`)
- ?ㅼ쨷 ?쒖옣 吏?? `--market-codes KOSDAQ,KOSPI`


## Docker Compose (PostgreSQL + API + Daily Collector)

1. `.env` 준비
- 최소 필요값: `KRX_AUTH_KEY`
- 필요 시 PostgreSQL 값 수정: `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`, `POSTGRES_PORT`

2. 실행
```bash
docker compose up -d --build
```

3. 확인
```bash
docker compose ps
curl http://localhost:8000/health
```

4. Daily 수집기
- `collector` 서비스가 상시 실행되며 기본값으로 UTC 기준 전일 데이터를 24시간마다 수집합니다.
- 조정 변수: `COLLECTOR_INTERVAL_SECONDS`, `COLLECTOR_DATE_OFFSET_DAYS`

5. 수집(기간 지정 1회 실행)
```bash
docker compose run --rm \
  -e DATE_FROM=2026-02-14 \
  -e DATE_TO=2026-02-21 \
  --profile collector collector-once
```

6. 종료
```bash
docker compose down
```
